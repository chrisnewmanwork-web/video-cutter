<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Cutter - Works Everywhere</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
        }

        .info-box {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            color: #0d47a1;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .upload-section {
            margin-bottom: 30px;
        }

        .upload-box {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .upload-box:hover {
            border-color: #764ba2;
            background: #f0f1ff;
        }

        .upload-box input {
            display: none;
        }

        .upload-label {
            font-size: 1.2em;
            color: #667eea;
            font-weight: 600;
        }

        .video-preview {
            margin: 30px 0;
            display: none;
        }

        video {
            width: 100%;
            max-width: 800px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: block;
            margin: 0 auto;
        }

        .video-info {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .time-controls {
            margin: 30px 0;
            display: none;
        }

        .time-range {
            background: #f8f9ff;
            border: 2px solid #e0e4ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        input[type="number"] {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-remove {
            background: #ff4757;
            color: white;
        }

        .btn-remove:hover {
            background: #e84118;
        }

        .btn-add {
            background: #667eea;
            color: white;
            width: 100%;
            margin-bottom: 20px;
        }

        .btn-add:hover {
            background: #764ba2;
        }

        .btn-process {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            padding: 16px;
            font-size: 1.1em;
        }

        .btn-process:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-process:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .info-text {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
            text-align: center;
        }

        .progress {
            display: none;
            margin: 20px 0;
            text-align: center;
        }

        .progress-text {
            color: #555;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .output-section {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .download-btn {
            background: #10ac84;
            color: white;
            display: block;
            width: 100%;
            margin-top: 15px;
        }

        .download-btn:hover {
            background: #0e9d73;
        }

        .helper-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .helper-btn {
            background: #f0f0f0;
            color: #555;
            padding: 8px 16px;
            font-size: 0.85em;
        }

        .helper-btn:hover {
            background: #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Video Cutter</h1>

        <div class="info-box">
            <strong>‚ú® Simple Video Cutter - Works Everywhere!</strong><br>
            All processing happens in your browser. No uploads, completely private.<br>
            Output format: WebM (compatible with all modern browsers)
        </div>
        
        <div class="upload-section">
            <div class="upload-box" onclick="document.getElementById('videoInput').click()">
                <input type="file" id="videoInput" accept="video/*">
                <div class="upload-label">üìÅ Click to upload a video</div>
            </div>
        </div>

        <div class="video-preview" id="videoPreview">
            <video id="videoPlayer" controls></video>
            <div class="video-info" id="videoInfo"></div>
            <div class="helper-buttons">
                <button class="btn helper-btn" onclick="setCurrentTimeAsStart()">Use Current Time as Start</button>
                <button class="btn helper-btn" onclick="setCurrentTimeAsEnd()">Use Current Time as End</button>
            </div>
        </div>

        <div class="time-controls" id="timeControls">
            <h2 style="margin-bottom: 20px; color: #333;">Time Ranges to Keep</h2>
            <div id="timeRanges"></div>
            <button class="btn btn-add" onclick="addTimeRange()">+ Add Time Range</button>
            
            <button class="btn btn-process" id="processBtn" onclick="processVideo()">Cut Video</button>
            <p class="info-text">Enter times in seconds. Output will be WebM format (plays in all modern browsers).</p>
        </div>

        <div class="progress" id="progress">
            <p class="progress-text" id="progressText">Processing video...</p>
        </div>

        <div class="output-section" id="outputSection">
            <h2 style="margin-bottom: 15px; color: #333;">‚úÖ Video Ready!</h2>
            <video id="outputVideo" controls style="margin-bottom: 15px;"></video>
            <button class="btn download-btn" onclick="downloadVideo()">‚¨áÔ∏è Download Cut Video</button>
        </div>
    </div>

    <script>
        let videoFile = null;
        let outputBlob = null;
        let videoDuration = 0;

        document.getElementById('videoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                videoFile = file;
                const videoURL = URL.createObjectURL(file);
                
                const videoPlayer = document.getElementById('videoPlayer');
                videoPlayer.src = videoURL;
                
                videoPlayer.addEventListener('loadedmetadata', function() {
                    videoDuration = videoPlayer.duration;
                    document.getElementById('videoInfo').textContent = 
                        `Duration: ${formatTime(videoDuration)} | File: ${file.name}`;
                });
                
                document.getElementById('videoPreview').style.display = 'block';
                document.getElementById('timeControls').style.display = 'block';
                
                if (document.getElementById('timeRanges').children.length === 0) {
                    addTimeRange();
                }
            }
        });

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function setCurrentTimeAsStart() {
            const video = document.getElementById('videoPlayer');
            const ranges = document.querySelectorAll('.time-range');
            if (ranges.length > 0) {
                const lastRange = ranges[ranges.length - 1];
                const startInput = lastRange.querySelector('.start-time');
                startInput.value = video.currentTime.toFixed(2);
            }
        }

        function setCurrentTimeAsEnd() {
            const video = document.getElementById('videoPlayer');
            const ranges = document.querySelectorAll('.time-range');
            if (ranges.length > 0) {
                const lastRange = ranges[ranges.length - 1];
                const endInput = lastRange.querySelector('.end-time');
                endInput.value = video.currentTime.toFixed(2);
            }
        }

        function addTimeRange() {
            const container = document.getElementById('timeRanges');
            
            const rangeDiv = document.createElement('div');
            rangeDiv.className = 'time-range';
            rangeDiv.innerHTML = `
                <div class="time-inputs">
                    <div class="input-group">
                        <label>Start Time (seconds)</label>
                        <input type="number" class="start-time" min="0" step="0.01" placeholder="0" value="0">
                    </div>
                    <div class="input-group">
                        <label>End Time (seconds)</label>
                        <input type="number" class="end-time" min="0" step="0.01" placeholder="${videoDuration}" value="${videoDuration}">
                    </div>
                    <button class="btn btn-remove" onclick="removeTimeRange(this)">Remove</button>
                </div>
            `;
            
            container.appendChild(rangeDiv);
        }

        function removeTimeRange(btn) {
            btn.closest('.time-range').remove();
        }

        function getTimeRanges() {
            const ranges = [];
            const rangeElements = document.querySelectorAll('.time-range');
            
            rangeElements.forEach(element => {
                const start = parseFloat(element.querySelector('.start-time').value) || 0;
                const end = parseFloat(element.querySelector('.end-time').value) || 0;
                
                if (end > start) {
                    ranges.push({ start, end });
                }
            });
            
            ranges.sort((a, b) => a.start - b.start);
            return ranges;
        }

        async function processVideo() {
            if (!videoFile) {
                alert('Please upload a video first!');
                return;
            }

            const ranges = getTimeRanges();
            if (ranges.length === 0) {
                alert('Please add at least one valid time range!');
                return;
            }
            
            try {
                document.getElementById('processBtn').disabled = true;
                document.getElementById('progress').style.display = 'block';
                document.getElementById('progressText').textContent = 'Preparing to cut video...';

                // Create a simple extraction using MediaRecorder
                const video = document.createElement('video');
                video.src = URL.createObjectURL(videoFile);
                video.muted = false;
                
                await new Promise(resolve => video.onloadedmetadata = resolve);

                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth || 640;
                canvas.height = video.videoHeight || 480;
                const ctx = canvas.getContext('2d');

                const stream = canvas.captureStream(30);
                
                // Add audio
                const audioContext = new AudioContext();
                const source = audioContext.createMediaElementSource(video);
                const dest = audioContext.createMediaStreamDestination();
                source.connect(dest);
                
                stream.addTrack(dest.stream.getAudioTracks()[0]);

                const recorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm;codecs=vp9,opus',
                    videoBitsPerSecond: 5000000
                });

                const chunks = [];
                recorder.ondataavailable = e => chunks.push(e.data);

                recorder.start();
                
                // Process each range
                for (let i = 0; i < ranges.length; i++) {
                    const range = ranges[i];
                    
                    document.getElementById('progressText').textContent = 
                        `Recording segment ${i + 1} of ${ranges.length}...`;
                    
                    video.currentTime = range.start;
                    await new Promise(resolve => video.onseeked = resolve);
                    
                    await video.play();
                    
                    const duration = (range.end - range.start) * 1000;
                    const startTime = Date.now();
                    
                    await new Promise(resolve => {
                        const draw = () => {
                            const elapsed = Date.now() - startTime;
                            if (elapsed >= duration || video.currentTime >= range.end) {
                                video.pause();
                                resolve();
                                return;
                            }
                            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                            requestAnimationFrame(draw);
                        };
                        draw();
                    });
                }

                recorder.stop();
                
                document.getElementById('progressText').textContent = 'Finalizing video...';
                
                await new Promise(resolve => {
                    recorder.onstop = () => {
                        outputBlob = new Blob(chunks, { type: 'video/webm' });
                        resolve();
                    };
                });

                audioContext.close();

                const outputURL = URL.createObjectURL(outputBlob);
                document.getElementById('outputVideo').src = outputURL;
                document.getElementById('outputSection').style.display = 'block';
                document.getElementById('progressText').textContent = 'Complete!';

                setTimeout(() => {
                    document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth' });
                }, 100);

            } catch (error) {
                console.error('Error:', error);
                alert('Error processing video: ' + error.message);
            } finally {
                document.getElementById('processBtn').disabled = false;
                setTimeout(() => {
                    document.getElementById('progress').style.display = 'none';
                }, 1000);
            }
        }

        function downloadVideo() {
            if (!outputBlob) return;
            
            const url = URL.createObjectURL(outputBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cut_video.webm';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
